<?php/** * @Project TMS Holdings * @Author VIETNAM DIGITAL TRADING JOINT STOCK COMPANY <contact@thuongmaiso.vn> * @Copyright (C) 2019 VIETNAM DIGITAL TRADING JOINT STOCK COMPANY. All rights reserved * @License GNU/GPL version 2 or any later version * @Createdate Mon, 07 Jan 2019 09:51:43 GMT */if (! defined('NV_SYSTEM')) {    die('Stop!!!');}if (! nv_function_exists('nv_company')) {    /**     * nv_company()     *     * @return     */    function nv_company($block_config)    {        global $nv_Cache, $global_config, $site_mods, $db_slave, $db,$module_name ,$lang_module;        $module = $block_config['module'];        if (! isset($site_mods[$module])) {            return '';        }				$sql = 'SELECT config_name, config_value FROM ' . NV_PREFIXLANG . '_home_config';		$list = $db->query($sql)->fetchAll(0);		$tms_config = array();		foreach ($list as $values) {			$tms_config[$values['config_name']] = $values['config_value'];		}            if (file_exists(NV_ROOTDIR . '/themes/' . $global_config['module_theme'] . '/modules/home/block.company.tpl')) {                $block_theme = $global_config['module_theme'];            } elseif (file_exists(NV_ROOTDIR . '/themes/' . $global_config['site_theme'] . '/modules/home/block.company.tpl')) {                $block_theme = $global_config['site_theme'];            } else {                $block_theme = 'default';            }           if (file_exists(NV_ROOTDIR . '/modules/home/language/' . NV_LANG_DATA . '.php')) {                require_once NV_ROOTDIR . '/modules/home/language/' . NV_LANG_DATA . '.php';            }            $xtpl = new XTemplate('block.company.tpl', NV_ROOTDIR . '/themes/' . $block_theme . '/modules/home');			$xtpl->assign('LANG', $lang_module);			$xtpl->assign('DATA', $tms_config);						if (! empty( $tms_config['company_hometext'])) {				$xtpl->parse('main.company_hometext');			}			if (! empty( $tms_config['company_name'])) {				if (! empty($tms_config['company_sortname'])) {					$xtpl->parse('main.company_name.company_sortname');				}				$xtpl->parse('main.company_name');			}			if (! empty( $tms_config['company_regcode'])) {				if (! empty($tms_config['company_regplace'])) {					$xtpl->parse('main.company_regcode.company_regplace');				}				$xtpl->parse('main.company_regcode');			}		$key = array();        $i = 0;        if (! empty($tms_config['company_responsibility'])) {            $xtpl->parse('main.company_responsibility');        }        if (! empty($tms_config['company_address'])) {            if (! empty($tms_config['company_map'])) {                $xtpl->parse('main.company_map_modal');            }            $xtpl->parse('main.company_address');        }        if (! empty($tms_config['company_phone'])) {            $nums = array_map('trim', explode('|', nv_unhtmlspecialchars($tms_config['company_phone'])));            foreach ($nums as $k => $num) {                unset($m);                if (preg_match("/^(.*)\s*\[([0-9\+\.\,\;\*\#]+)\]$/", $num, $m)) {                    $xtpl->assign('PHONE', array( 'number' => nv_htmlspecialchars($m[1]), 'href' => $m[2] ));                    $xtpl->parse('main.company_phone.item.href');                    $xtpl->parse('main.company_phone.item.href2');                } else {                    $num = preg_replace("/\[[^\]]*\]/", "", $num);                    $xtpl->assign('PHONE', array( 'number' => nv_htmlspecialchars($num) ));                }                if ($k) {                    $xtpl->parse('main.company_phone.item.comma');                }                $xtpl->parse('main.company_phone.item');            }            $xtpl->parse('main.company_phone');        }		  if (! empty($tms_config['company_hotline'])) {            $nums = array_map('trim', explode('|', nv_unhtmlspecialchars($tms_config['company_hotline'])));            foreach ($nums as $k => $num) {                unset($m);                if (preg_match("/^(.*)\s*\[([0-9\+\.\,\;\*\#]+)\]$/", $num, $m)) {                    $xtpl->assign('HOTLINE', array( 'number' => nv_htmlspecialchars($m[1]), 'href' => $m[2] ));                    $xtpl->parse('main.company_hotline.item.href');                    $xtpl->parse('main.company_hotline.item.href2');                } else {                    $num = preg_replace("/\[[^\]]*\]/", "", $num);                    $xtpl->assign('HOTLINE', array( 'number' => nv_htmlspecialchars($num) ));                }                if ($k) {                    $xtpl->parse('main.company_hotline.item.comma');                }                $xtpl->parse('main.company_hotline.item');            }            $xtpl->parse('main.company_hotline');        }        if (! empty($tms_config['company_fax'])) {            $xtpl->parse('main.company_fax');        }        if (! empty($tms_config['company_email'])) {            $emails = array_map('trim', explode(',', $tms_config['company_email']));            foreach ($emails as $k => $email) {                $xtpl->assign('EMAIL', $email);                if ($k) {                    $xtpl->parse('main.company_email.item.comma');                }                $xtpl->parse('main.company_email.item');            }            $xtpl->parse('main.company_email');        }        if (! empty($tms_config['company_website'])) {            $webs = array_map('trim', explode(',', $tms_config['company_website']));            foreach ($webs as $k => $web) {                if (! preg_match("/^https?\:\/\//", $web)) {                    $web = 'http://' . $web;                }                $xtpl->assign('WEBSITE', $web);                if ($k) {                    $xtpl->parse('main.company_website.item.comma');                }                $xtpl->parse('main.company_website.item');            }            $xtpl->parse('main.company_website');        }        $xtpl->assign('SITE_LOGO', NV_MY_DOMAIN . NV_BASE_SITEURL . $global_config['site_logo']);            $xtpl->parse('main');            return $xtpl->text('main');        return '';    }}$content = nv_company($block_config);